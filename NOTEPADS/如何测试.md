# 如何测试

## 1. Jest 配置调整
- **isolated-vm 模块问题：**  
  由于 `isolated-vm` 模块在内部导入 `.node` 文件时未指定扩展名，导致测试报错。解决方式是在 Jest 配置的 `moduleFileExtensions` 中添加 `"node"` 以便能正确解析这些文件。

- **多个配置文件冲突：**  
  不允许同时存在多个 Jest 配置来源，如 package.json 中的 `"jest"` 配置与独立的 `jest.config.js`。需要选择其中一个作为测试配置，移除或重命名冗余的配置文件。

## 2. 测试目录和文件的组织
- **测试文件命名：**  
  测试文件应以 `.spec.ts` 或 `.test.ts` 结尾，符合 Jest 默认的匹配规则。
- **忽略不需要的测试：**  
  通过 `testPathIgnorePatterns` 配置忽略指定目录下的测试文件，如 `ai/model/`、`/service/common/`、`/pages/api/` 等。注意，`coveragePathIgnorePatterns` 仅用于覆盖率报告，不会阻止测试执行。

## 3. Helloworld 示例
- **示例代码：**  
  在 `src/package/app/app.ts` 中定义了一个简单的 `sayHello` 函数，在相应的 `app.spec.ts` 文件中编写测试，验证返回值为 `"Hello, world!"`。

## 4. 数据库测试及数据清理策略
- **事务回滚：**  
  如果数据库支持事务，可以在每个测试开始时启动事务，并在测试结束后回滚，从而保证测试数据不被持久保存。
- **手动清理：**  
  利用 Jest 的生命周期钩子（如 `afterEach` 或 `afterAll`）手动删除或清空测试过程中添加的数据，确保每个测试都有一个干净的环境。

以上总结涵盖了针对 Jest 的配置调整、测试文件结构设计、示例测试代码的编写，以及如何在测试数据库添加数据后进行清理的多种方式。 